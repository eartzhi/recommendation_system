# Итоговый проект. “Определение уязвимых групп населения”

## Оглавление   
[1. Постановка задачи](#оглавление)
[2. Формат исходных данных](#оглавление)  
[3. Построение валидации](#краткая-информация-о-данных)  
[4. Трансформации исходного датасета](#какой-кейс-решаем)    
[5. Эксперименты](#этапы-работы-над-проектом) 
[6. Создание Docker образа](#этапы-работы-над-проектом) 
[7. API ](#этапы-работы-над-проектом)     
[8. Результат](#результаты)    

### 1. Постановка задачи    
Дипломный проект второго года обучения "Рекомендательная система".

Цель работы: Повысить прибыль от допродаж в интернет-магазине Заказчика на 20%. С этой целью построить рекомендательную систему товаров для выдачи топ трех товаров, рекомендуемых пользователю.

Метрика качества: Precision@3.

:arrow_up:[к оглавлению](#оглавление)


### 2. Формат исходных данных    

Исходные данные предсталены четыремя фалами с набором данных:
*events.csv* - набор событий
*item_properties_part1.csv, item_properties_part2.csv* - соотношение товаров и их свойств
*category_tree.csv* - соотношение категорий с родительской категорией товара

После импорта и объединения двух частей файла item_properties получили следующие датафреймы:
**events — датасет с событиями.**   
**Колонки:**  
- *timestamp* — время события (int64)
- *visitorid* — идентификатор пользователя (int64)
- *event* — тип события (object)
    - *view* (просмотр карточки товара)  
    - *addtocart* (добавление в корзину)  
    - *transaction* (покупка)
- *itemid* — идентификатор объекта (int64)
- *transactionid* — идентификатор транзакции, если она проходила (float64)

**category_tree — файл с деревом категорий (можно восстановить дерево).**  
**Колонки:**    
- *category_id* — идентификатор категорий (int64)
- *parent_id* — идентификатор родительской категории (float64)


**item_properties — файл с свойствами товаров.**  
**Колонки:**  
- *timestamp* — момент записи значения свойства (int64)
- *item_id* — идентификатор объекта (int64)
- *property* — свойство. Все, кроме категории, захешированы (object) 
- *value* — значение свойства (object)

:arrow_up:[к оглавлению](#оглавление)


### 3. Построение валидации

После получения датасета событий с целью создания валидационной выборки датафрейм был отсортирован по возрастанию параметра timestamp. Тестовая выборка составляет 20% от датасета events. Разделение организовано по времени

:arrow_up:[к оглавлению](#оглавление)


### 4. Трансформации исходного датасета 

1. Для каждого товара было выделено по 4 категории товара в соотвествии сдатасетом item_properties.
2. Из общих чеков на товар для каждого купленого товара был о выделено два товара, чаще всего присутствующих в чеке с рассматриваемым товаром.
3. Для каждого товара добавлено по 4 родительских категории товара в соотвествии сдатасетом category_tree.
4. Для каждого пользователя добавлен id чаще всего просматриваемого товара.
5. Для каждого пользователя добавлено 4 чаще всего просматриваемые категории.
6. Для каждого пользователя добавлен id товара чаще всего добавляемого в корзину.
7. Для каждого пользователя добавлено 4 категории товаров чаще всего добавляемых в корзину.
8. Для каждого пользователя добавлен id чаще всего покупаемого товара.
9. Для каждого пользователя добавлено 4 категории чаще всего покупаемых товаров.
10. На основании наибольшей активности пользователя для каждого пользователя добавлено любимое время суток.

Все признаки сведены в единый тренировочный датасет.

тогом работы стали следующие датасеты:
**items — признаки товара**   
**Колонки:**  
- *itemid* — идентификатор объекта 
- *item_category_1* — первая категория товаров
- *item_category_2* — вторая категория товаров
- *item_category_3* — третья категория товаров
- *item_category_4* — четвертая категория товаров
- *item_parent_category_1* — родительская категория первой категории товаров
- *item_parent_category_2* — родительская категория второй категории товаров
- *item_parent_category_3* — родительская категория третьей категории товаров
- *item_parent_category_4* — родительская категория четвертой категории товаров
- *buy_with_1* — первый сопутствующий товар
- *buy_with_2* — второй сопутствующий товар

**users — характеристики пользователя**   
**Колонки:**  
- *visitorid* — идентификатор пользователя 
- *itemid_viewed* — наиболее просматириваемый пользователем товар 
- *item_category_1_viewed* — первая наиболее просматриваемая категория товаров
- *item_category_2_viewed* — вторая наиболее просматриваемая категория товаров
- *item_category_3_viewed* — третья наиболее просматриваемая категория товаров
- *item_category_4_viewed* — четвертая наиболее просматриваемая категория товаров
- *itemid_added* — товар, чаще всего добавляемый пользователем в корзину 
- *item_category_1_added* — первая категория товара, чаще всего добавляемый пользователем в корзину
- *item_category_2_added* — вторая категория товара, чаще всего добавляемый пользователем в корзину
- *item_category_3_added* — третья категория товара, чаще всего добавляемый пользователем в корзину
- *item_category_4_added* — четвертая категория товара, чаще всего добавляемый пользователем в корзину
- *itemid_buyed* — чаще всего покупаемый товар
- *item_category_1_buyed* — первая чаще всего покупаемая категория товаров
- *item_category_2_buyed* — вторая чаще всего покупаемая категория товаров
- *item_category_3_buyed* — третья чаще всего покупаемая категория товаров
- *item_category_4_buyed* — четвертая чаще всего покупаемая категория товаров
- *time_of_day_favorite* — время наибольшей активности пользователя
- *dayofweek_favorite* — день недели наибольшей активности пользователя

**events_train_feature — тренировочный датасет с событиями и признаками товаров и пользователей.**   
**Колонки:**  
- *timestamp* — время события
- *visitorid* — идентификатор пользователя
- *event* — тип события
    - *view* (просмотр карточки товара)  
    - *addtocart* (добавление в корзину)  
    - *transaction* (покупка)
- *itemid* — идентификатор объекта
- *transactionid* — идентификатор транзакции, если она проходила  
- *item_category_1* — первая категория товаров
- *item_category_2* — вторая категория товаров
- *item_category_3* — третья категория товаров
- *item_category_4* — четвертая категория товаров
- *item_parent_category_1* — родительская категория первой категории товаров
- *item_parent_category_2* — родительская категория второй категории товаров
- *item_parent_category_3* — родительская категория третьей категории товаров
- *item_parent_category_4* — родительская категория четвертой категории товаров
- *buy_with_1* — первый сопутствующий товар
- *buy_with_2* — второй сопутствующий товар
- *visitorid* — идентификатор пользователя 
- *itemid_viewed* — наиболее просматириваемый пользователем товар 
- *item_category_1_viewed* — первая наиболее просматриваемая категория товаров
- *item_category_2_viewed* — вторая наиболее просматриваемая категория товаров
- *item_category_3_viewed* — третья наиболее просматриваемая категория товаров
- *item_category_4_viewed* — четвертая наиболее просматриваемая категория товаров
- *itemid_added* — товар, чаще всего добавляемый пользователем в корзину 
- *item_category_1_added* — первая категория товара, чаще всего добавляемый пользователем в корзину
- *item_category_2_added* — вторая категория товара, чаще всего добавляемый пользователем в корзину
- *item_category_3_added* — третья категория товара, чаще всего добавляемый пользователем в корзину
- *item_category_4_added* — четвертая категория товара, чаще всего добавляемый пользователем в корзину
- *itemid_buyed* — чаще всего покупаемый товар
- *item_category_1_buyed* — первая чаще всего покупаемая категория товаров
- *item_category_2_buyed* — вторая чаще всего покупаемая категория товаров
- *item_category_3_buyed* — третья чаще всего покупаемая категория товаров
- *item_category_4_buyed* — четвертая чаще всего покупаемая категория товаров
- *time_of_day_favorite* — время наибольшей активности пользователя
- *dayofweek_favorite* — день недели наибольшей активности пользователя


Для обучения моделей, работающих на основании рейтингов были произведены следующие трансформации:
1. Определена бальная шкала действий пользователей: view=1, addtocart=5, transaction=10
2. Определены понижающие коэффициенты длякатегорий и родительских категорий: для категорий=0.1, для родительских категорий 0.01
3. Составден датасет ratings в котором соотношение пользователь-товар получает 1 бал если он пользователь просмотрел товар, 5 баллов если добавил товар в корзину, 10 баллов если купил товар. Так же для категорий и родительских категорий: Если пользватель просмотрел товар данной категории, то все товары данной категории для пользователя поднимаются в рейтинге на 1x0.1, добавил корзину - 5x0.01, купил - 10x0.1. Для родительской категории аналогично, но с коэффициентом 0.01.

В результате получаем датасет с соотношением пользователь-товар и соответствующим рейтингом.

:arrow_up:[к оглавлению](#оглавление)


### Вывод:  
Рамках работы выб выявлен кластер неблагополучных регионов, требующих финансовых вливаний для улучшения условий жизни населения. Неблагополучными за 2020 год можно признать следующие регионы: Карачаево-черкесская республика, Курганская обл., Псковская обл., Чувашская республика.  
Как следствие низких доходов населения и высокого уровня бедности в этих регионах происходит рост тяжких и особо тяжких преступлений и падение рождаемости. Сами низкие доходы населения порождены предположительно низким уровнем производства и оборотом розничной торговли в регионе. Увеличение процента средств, выделяемых на социальное развитие не оказывает сильного влияния (или не успел оказать) на уровень бедности.  
Для улучшения ситуации в регионах требуется увеличение уровня производств, который моожет проявиться только как вложение средств в производства в регионах.  

:arrow_up:[к оглавлению](#оглавление)
